<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discovery - Research Notebook</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-book-open"></i>
                    <h1>Discovery</h1>
                </div>
                <div class="header-actions">
                    <button id="themeToggle" class="theme-toggle" title="Toggle Dark Mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button id="newNotebookBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> New Notebook
                    </button>
                    <button id="searchToggleBtn" class="btn btn-secondary">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Global Search Panel -->
        <div id="searchPanel" class="search-panel hidden">
            <div class="search-container">
                <input type="text" id="globalSearchInput" placeholder="Search across all notebooks and sources..." class="search-input">
                <button id="globalSearchBtn" class="btn btn-primary">
                    <i class="fas fa-search"></i> Search
                </button>
                <button id="closeSearchBtn" class="btn btn-secondary">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="searchResults" class="search-results"></div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <h2>Notebooks</h2>
                    <div class="sidebar-actions">
                        <select id="sortSelect" class="sort-select">
                            <option value="updated_at">Last Modified</option>
                            <option value="name">Name</option>
                            <option value="created_at">Date Created</option>
                            <option value="source_count">Source Count</option>
                        </select>
                        <button id="refreshNotebooksBtn" class="btn btn-icon" title="Refresh">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="notebooks-filter">
                    <input type="text" id="notebooksFilter" placeholder="Filter notebooks..." class="filter-input">
                </div>
                <div id="notebooksList" class="notebooks-list">
                    <div class="loading">Loading notebooks...</div>
                </div>
            </aside>

            <!-- Content Area -->
            <section class="content-area">
                <!-- Welcome Screen -->
                <div id="welcomeScreen" class="welcome-screen">
                    <div class="welcome-content">
                        <i class="fas fa-book-open welcome-icon"></i>
                        <h2>Welcome to Discovery</h2>
                        <p>Your local research companion. Create notebooks, import sources, and generate insights.</p>
                        <button id="createFirstNotebookBtn" class="btn btn-primary btn-large">
                            <i class="fas fa-plus"></i> Create Your First Notebook
                        </button>
                    </div>
                </div>

                <!-- Notebook View -->
                <div id="notebookView" class="notebook-view hidden">
                    <!-- Notebook Header -->
                    <div class="notebook-header">
                        <div class="notebook-info">
                            <h2 id="notebookTitle" class="notebook-title">Notebook Name</h2>
                            <p id="notebookDescription" class="notebook-description">Description</p>
                            <div id="notebookTags" class="notebook-tags"></div>
                            <div class="notebook-stats">
                                <span id="sourceCount">0 sources</span>
                                <span id="lastModified">Last modified: Never</span>
                            </div>
                        </div>
                        <div class="notebook-actions">
                            <button id="editNotebookBtn" class="btn btn-secondary">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button id="deleteNotebookBtn" class="btn btn-danger">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                            <div class="dropdown">
                                <button id="moreActionsBtn" class="btn btn-secondary dropdown-toggle">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <button id="ingestNotebookBtn" class="dropdown-item">
                                        <i class="fas fa-database"></i> Ingest to Vector DB
                                    </button>
                                    <button id="searchSimilarBtn" class="dropdown-item">
                                        <i class="fas fa-search-plus"></i> Semantic Search
                                    </button>
                                    <button id="qaToggleBtn" class="dropdown-item">
                                        <i class="fas fa-question-circle"></i> Ask Questions
                                    </button>
                                    <button id="generateBlogPostBtn" class="dropdown-item">
                                        <i class="fas fa-pen-fancy"></i> Generate Blog Post
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sources Section -->
                    <div class="sources-section">
                        <div class="sources-header">
                            <h3>Sources</h3>
                            <div class="sources-actions">
                                <button id="addFileSourceBtn" class="btn btn-primary">
                                    <i class="fas fa-file-upload"></i> Add File
                                </button>
                                <button id="addUrlSourceBtn" class="btn btn-primary">
                                    <i class="fas fa-link"></i> Add URL
                                </button>
                                <button id="addTextSourceBtn" class="btn btn-primary">
                                    <i class="fas fa-align-left"></i> Add Text
                                </button>
                                <button id="addBySearchBtn" class="btn btn-secondary">
                                    <i class="fas fa-search"></i> Search & Add
                                </button>
                            </div>
                        </div>
                        <div class="sources-filter">
                            <input type="text" id="sourcesFilter" placeholder="Filter sources..." class="filter-input">
                            <select id="sourceTypeFilter" class="filter-select">
                                <option value="">All Types</option>
                                <option value="file">Files</option>
                                <option value="url">URLs</option>
                                <option value="text">Text</option>
                            </select>
                        </div>
                        <div id="sourcesList" class="sources-list">
                            <div class="no-sources">
                                <i class="fas fa-folder-open"></i>
                                <p>No sources yet. Add files or URLs to get started.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Outputs Section -->
                    <div class="outputs-section">
                        <div class="outputs-header">
                            <h3>Outputs</h3>
                            <button id="refreshOutputsBtn" class="btn btn-icon" title="Refresh">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <div id="outputsList" class="outputs-list">
                            <div class="no-outputs">
                                <i class="fas fa-file-alt"></i>
                                <p>No outputs yet. Generate blog posts or other outputs to see them here.</p>
                            </div>
                        </div>
                    </div>

                    <!-- QA Section -->
                    <div id="qaSection" class="qa-section hidden">
                        <div class="qa-header">
                            <h3>Ask Questions</h3>
                            <button id="closeQaBtn" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Close
                            </button>
                        </div>
                        <div id="qaConversation" class="qa-conversation">
                            <div class="qa-welcome">
                                <i class="fas fa-question-circle"></i>
                                <p>Ask questions about your notebook content. I'll search through your sources and provide answers with citations.</p>
                            </div>
                        </div>
                        <div class="qa-input-section">
                            <div class="form-group">
                                <textarea id="questionInput" class="form-textarea" rows="3" 
                                        placeholder="Ask a question about your notebook content..." 
                                        maxlength="10000"></textarea>
                            </div>
                            <div class="qa-controls">
                                <div class="qa-settings">
                                    <label for="qaMaxSources">Sources:</label>
                                    <select id="qaMaxSources" class="form-select">
                                        <option value="3">3</option>
                                        <option value="5" selected>5</option>
                                        <option value="10">10</option>
                                        <option value="15">15</option>
                                    </select>
                                    <label for="qaTemperature">Creativity:</label>
                                    <select id="qaTemperature" class="form-select">
                                        <option value="0.1">Factual</option>
                                        <option value="0.3" selected>Balanced</option>
                                        <option value="0.7">Creative</option>
                                    </select>
                                </div>
                                <button id="askQuestionBtn" class="btn btn-primary" disabled>
                                    <i class="fas fa-paper-plane"></i> Ask Question
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <!-- Create/Edit Notebook Modal -->
    <div id="notebookModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="notebookModalTitle">Create New Notebook</h3>
                <button class="modal-close" data-modal="notebookModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="notebookForm">
                    <div class="form-group">
                        <label for="notebookName">Name *</label>
                        <input type="text" id="notebookName" name="name" required maxlength="255" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="notebookDescriptionInput">Description</label>
                        <textarea id="notebookDescriptionInput" name="description" maxlength="2000" class="form-textarea" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="notebookTagsInput">Tags (comma-separated)</label>
                        <input type="text" id="notebookTagsInput" name="tags" class="form-input" placeholder="research, ai, technology">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-modal="notebookModal">Cancel</button>
                <button type="submit" form="notebookForm" id="saveNotebookBtn" class="btn btn-primary">Create Notebook</button>
            </div>
        </div>
    </div>

    <!-- Add File Source Modal -->
    <div id="fileSourceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add File Source</h3>
                <button class="modal-close" data-modal="fileSourceModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="fileSourceForm">
                    <div class="form-group">
                        <label for="sourceFile">File *</label>
                        <input type="file" id="sourceFile" name="file" accept=".pdf,.txt,.md,.doc,.docx" required class="form-input">
                        <small class="form-help">Supported formats: PDF, TXT, MD, DOC, DOCX</small>
                    </div>
                    <div class="form-group">
                        <label for="sourceFileName">Name *</label>
                        <input type="text" id="sourceFileName" name="name" required maxlength="500" class="form-input">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-modal="fileSourceModal">Cancel</button>
                <button type="submit" form="fileSourceForm" id="saveFileSourceBtn" class="btn btn-primary">Add Source</button>
            </div>
        </div>
    </div>

    <!-- Add URL Source Modal -->
    <div id="urlSourceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add URL Source</h3>
                <button class="modal-close" data-modal="urlSourceModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="urlSourceForm">
                    <div class="form-group">
                        <label for="sourceUrl">URL *</label>
                        <input type="url" id="sourceUrl" name="url" required class="form-input" placeholder="https://example.com/article">
                    </div>
                    <div class="form-group">
                        <label for="sourceUrlTitle">Title (optional)</label>
                        <input type="text" id="sourceUrlTitle" name="title" maxlength="500" class="form-input" placeholder="Leave empty to extract from page">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-modal="urlSourceModal">Cancel</button>
                <button type="submit" form="urlSourceForm" id="saveUrlSourceBtn" class="btn btn-primary">Add Source</button>
            </div>
        </div>
    </div>

    <!-- Add Text Source Modal -->
    <div id="textSourceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Text Source</h3>
                <button class="modal-close" data-modal="textSourceModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="textSourceForm">
                    <div class="form-group">
                        <label for="sourceTextTitle">Title *</label>
                        <input type="text" id="sourceTextTitle" name="title" required maxlength="500" 
                               class="form-input" placeholder="Give your text a descriptive title">
                    </div>
                    <div class="form-group">
                        <label for="sourceTextContent">Content *</label>
                        <textarea id="sourceTextContent" name="content" required 
                                  class="form-textarea" rows="15" maxlength="100000"
                                  placeholder="Paste your text content here..."></textarea>
                        <small class="form-help">Maximum 100,000 characters</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-modal="textSourceModal">Cancel</button>
                <button type="submit" form="textSourceForm" id="saveTextSourceBtn" class="btn btn-primary">Add Source</button>
            </div>
        </div>
    </div>

    <!-- Add Sources by Search Modal -->
    <div id="searchSourceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Search & Add Sources</h3>
                <button class="modal-close" data-modal="searchSourceModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="searchSourceForm">
                    <div class="form-group">
                        <label for="searchPhrase">Search Phrase or Question *</label>
                        <textarea id="searchPhrase" name="searchPhrase" required class="form-textarea" rows="3" 
                                placeholder="Enter a search phrase or question to find relevant articles..."></textarea>
                        <small class="form-help">Example: "machine learning best practices" or "How does blockchain work?"</small>
                    </div>
                    <div class="form-group">
                        <label for="maxArticles">Maximum Articles</label>
                        <select id="maxArticles" name="maxArticles" class="form-select">
                            <option value="3">3 articles</option>
                            <option value="5" selected>5 articles</option>
                            <option value="7">7 articles</option>
                            <option value="10">10 articles</option>
                        </select>
                        <small class="form-help">The system will search for and attempt to add this many relevant articles</small>
                    </div>
                </form>
                <div id="searchSourceResults" class="search-source-results hidden">
                    <h4>Search Results</h4>
                    <div id="searchSourceResultsList"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-modal="searchSourceModal">Cancel</button>
                <button type="submit" form="searchSourceForm" id="executeSearchSourceBtn" class="btn btn-primary">
                    <i class="fas fa-search"></i> Search & Add
                </button>
            </div>
        </div>
    </div>

    <!-- Source Viewer Modal -->
    <div id="sourceViewerModal" class="modal modal-large">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="sourceViewerTitle">Source Content</h3>
                <div class="modal-header-actions">
                    <button id="downloadSourceBtn" class="btn btn-secondary btn-sm">
                        <i class="fas fa-download"></i> Download
                    </button>
                    <button class="modal-close" data-modal="sourceViewerModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="modal-body">
                <div class="source-viewer-content">
                    <div id="sourceContentLoader" class="loading">Loading content...</div>
                    <div id="sourceContent" class="source-content"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Semantic Search Modal -->
    <div id="semanticSearchModal" class="modal modal-large">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Semantic Search</h3>
                <button class="modal-close" data-modal="semanticSearchModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="semanticSearchQuery">Search Query</label>
                    <textarea id="semanticSearchQuery" class="form-textarea" rows="3" placeholder="Enter your search query here..."></textarea>
                </div>
                <div class="form-group">
                    <label for="searchResultLimit">Results Limit</label>
                    <select id="searchResultLimit" class="form-select">
                        <option value="5">5 results</option>
                        <option value="10" selected>10 results</option>
                        <option value="20">20 results</option>
                        <option value="50">50 results</option>
                    </select>
                </div>
                <button id="executeSemanticSearchBtn" class="btn btn-primary">
                    <i class="fas fa-search"></i> Search
                </button>
                <div id="semanticSearchResults" class="search-results"></div>
            </div>
        </div>
    </div>

    <!-- Output Viewer Modal -->
    <div id="outputViewerModal" class="modal modal-large">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="outputViewerTitle">Output Content</h3>
                <div class="modal-header-actions">
                    <button id="downloadOutputBtn" class="btn btn-secondary btn-sm">
                        <i class="fas fa-download"></i> Download
                    </button>
                    <button id="deleteOutputFromViewerBtn" class="btn btn-danger btn-sm">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                    <button class="modal-close" data-modal="outputViewerModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="modal-body">
                <div class="output-viewer-content">
                    <div id="outputContentLoader" class="loading">Loading content...</div>
                    <div id="outputContent" class="output-content"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirmationTitle">Confirm Action</h3>
                <button class="modal-close" data-modal="confirmationModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p id="confirmationMessage">Are you sure you want to perform this action?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-modal="confirmationModal">Cancel</button>
                <button type="button" id="confirmActionBtn" class="btn btn-danger">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Generate Blog Post Modal -->
    <div id="blogPostModal" class="modal modal-large">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Generate Blog Post</h3>
                <button class="modal-close" data-modal="blogPostModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="blogPostForm">
                    <div class="form-group">
                        <label for="blogPostTitle">Blog Post Title *</label>
                        <input type="text" id="blogPostTitle" name="title" required maxlength="500" class="form-input" 
                               placeholder="Enter a compelling title for your blog post">
                    </div>
                    <div class="form-group">
                        <label for="blogPostPrompt">Custom Prompt (optional)</label>
                        <textarea id="blogPostPrompt" name="prompt" maxlength="5000" class="form-textarea" rows="4" 
                                placeholder="Provide specific instructions for how you want the blog post written (e.g., 'Focus on practical tips', 'Write for beginners', 'Include technical details')"></textarea>
                        <small class="form-help">Leave empty to use the default blog post generation approach</small>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="blogPostTone">Tone</label>
                            <select id="blogPostTone" name="tone" class="form-select">
                                <option value="informative" selected>Informative</option>
                                <option value="casual">Casual</option>
                                <option value="formal">Formal</option>
                                <option value="conversational">Conversational</option>
                                <option value="academic">Academic</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="blogPostWordCount">Target Word Count</label>
                            <select id="blogPostWordCount" name="wordCount" class="form-select">
                                <option value="400">400 words</option>
                                <option value="550" selected>550 words</option>
                                <option value="700">700 words</option>
                                <option value="1000">1000 words</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="blogPostTemplate">Template (optional)</label>
                        <select id="blogPostTemplate" name="template" class="form-select">
                            <option value="">Default Structure</option>
                            <option value="how-to">How-To Guide</option>
                            <option value="listicle">List Article</option>
                            <option value="comparison">Comparison/Review</option>
                            <option value="case-study">Case Study</option>
                            <option value="opinion">Opinion/Editorial</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeReferences" name="includeReferences" checked>
                            <span class="checkmark"></span>
                            Include reference links at the bottom
                        </label>
                    </div>
                </form>
                <div id="blogPostProgress" class="generation-progress hidden">
                    <div class="progress-header">
                        <i class="fas fa-magic"></i>
                        <h4>Generating Blog Post...</h4>
                    </div>
                    <div class="progress-steps">
                        <div class="progress-step" data-step="extract">
                            <i class="fas fa-file-text"></i>
                            <span>Extracting content from sources</span>
                            <div class="step-status"></div>
                        </div>
                        <div class="progress-step" data-step="generate">
                            <i class="fas fa-brain"></i>
                            <span>Generating blog post with AI</span>
                            <div class="step-status"></div>
                        </div>
                        <div class="progress-step" data-step="complete">
                            <i class="fas fa-check"></i>
                            <span>Finalizing and adding references</span>
                            <div class="step-status"></div>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                </div>
                <div id="blogPostResult" class="blog-post-result hidden">
                    <div class="result-header">
                        <h4>Generated Blog Post</h4>
                        <div class="result-actions">
                            <button id="regenerateBlogPostBtn" class="btn btn-warning btn-sm">
                                <i class="fas fa-sync-alt"></i> Regenerate
                            </button>
                            <button id="copyBlogPostBtn" class="btn btn-secondary btn-sm">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                            <button id="downloadBlogPostBtn" class="btn btn-secondary btn-sm">
                                <i class="fas fa-download"></i> Download
                            </button>
                            <button id="editBlogPostBtn" class="btn btn-primary btn-sm">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        </div>
                    </div>
                    <div id="blogPostContent" class="blog-post-content"></div>
                    <div class="result-stats">
                        <span id="blogPostWordCountDisplay">0 words</span>
                        <span id="blogPostGenTime">Generated in 0s</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-modal="blogPostModal">Close</button>
                <button type="submit" form="blogPostForm" id="generateBlogPostSubmitBtn" class="btn btn-primary">
                    <i class="fas fa-magic"></i> Generate Blog Post
                </button>
                <button id="saveBlogPostBtn" class="btn btn-success hidden">
                    <i class="fas fa-save"></i> Save Blog Post
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p id="loadingMessage">Loading...</p>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>